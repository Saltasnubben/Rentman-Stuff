# 2026-02-02 - Rentman Booking Visualizer Session

## Major Features Added

### 1. Project Status Support
- **Discovery:** Status lives on `subprojects`, not `projects` directly
- Added `/api/statuses` endpoint - lists all statuses (Pending, Canceled, Confirmed, Prepped, On location, Returned, Inquiry, Concept)
- Added `/api/subprojects` endpoint with status mapping
- Status IDs: 1=Pending, 2=Canceled, 3=Confirmed, 4=Prepped, 5=On location, 6=Returned, 7=Inquiry, 8=Concept

### 2. Unfilled Roles (`/api/unfilled`)
- Shows project functions without assigned crew
- **Filtered to Confirmed projects only** by default (`?status=3`)
- Can use `?status=all` or `?status=1,3` for multiple statuses
- **Performance optimized** from 100+ seconds to ~3 seconds (cold cache)
- Separates **crew vs transport** (`isTransport` field based on role name containing "Transport")

### 3. UI Improvements
- **Auto-switch to Project view** when enabling unfilled roles
- **Loading spinner** when fetching unfilled roles
- **Project icons** in project view:
  - Bar chart icon (horizontal bar over 3 vertical bars) for projects
  - Green = Confirmed, Yellow = other status
  - Calendar icon for appointments
  - Person+ icon for unfilled
- **Stats boxes** show:
  - Otillsatt personal (red) 
  - Otillsatta transporter (orange)
- **Timeline colors:**
  - Red dashed = unfilled crew
  - Orange dashed = unfilled transport

### 4. Bookings Enhancements
- Added `projectNumber` and `accountManager` fields
- Added `statusId` field
- **Performance optimized** - bulk fetch projectcrew instead of N queries
- Warm cache: 0.1 seconds (was 8+ seconds)

## Technical Notes

### API Optimization Strategy
1. Fetch bulk data (subprojects, projectcrew) with limit=300 (Rentman max)
2. Filter in PHP instead of making N API calls
3. Only fetch functions for relevant (Confirmed + date-filtered) projects
4. Cache TTL: 5 minutes (300 seconds)

### Rentman API Quirks
- `planperiod_*` fields are "generated" and can't be used in query filters
- Status is on subproject level, referenced as `/statuses/X`
- Max 300 items per API response

## FTP Deployment
- Server: ftp.astronauten.se
- User: astronauten.se
- GitHub Actions was having runner queue issues - used direct FTP upload via curl

## Files Modified
- `public/api/endpoints/unfilled.php` - Major rewrite for performance
- `public/api/endpoints/bookings.php` - Bulk fetch optimization, added fields
- `public/api/endpoints/subprojects.php` - New endpoint
- `public/api/index.php` - Added routes for statuses/subprojects
- `frontend/src/App.jsx` - Stats boxes, loading states, auto view switch
- `frontend/src/components/Timeline.jsx` - Icons, transport/crew colors
